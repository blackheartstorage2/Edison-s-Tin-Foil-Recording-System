<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tin Foil Phonograph Virtual Build</title>
  <style>
    body { font-family: Arial; background: #f4f4f4; margin: 20px; }
    h1, .instructions, .audio-controls { text-align: center; }
    .image-grid { display: flex; flex-wrap: wrap; gap:10px; border:2px dashed #ccc; padding:10px; background:#fff; }
    .image-grid img { width:100px; cursor:grab; }
    #buildArea { position:relative; width:500px; height:350px; margin:20px auto; border:2px dashed #ccc; background:#fff; }
    #buildArea img { position:absolute; width:100px; cursor:pointer; transition:transform .2s; }
    #buildArea img:hover { transform:scale(1.1); z-index:10; }
    button { margin:10px; padding:10px 20px; font-size:16px; cursor:pointer; }
  </style>
</head>
<body>
  <h1>Build Edison's Tin Foil Recorder</h1>
  <div class="instructions">
    <p>Drag parts into build area; click parts in build to remove them.</p>
  </div>
  <h2>Parts</h2>
  <div class="image-grid" id="imageGrid"></div>
  <h2>Build Area</h2>
  <div id="buildArea" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
  <div class="audio-controls">
    <h2>Audio Recorder</h2>
    <button onclick="startRecording()">Start</button>
    <button onclick="stopRecording()">Stop</button>
    <button onclick="playRecording()">Play</button>
    <audio id="audioPlayback" controls></audio>
  </div>

  <script>
  // Populate parts grid after DOM ready
  document.addEventListener("DOMContentLoaded", () => {
    const partFiles = [
      '0000D_.jpg','0000B.jpg','0000C.jpg','0000A_.jpg',
      '00003.jpg','00004.jpg','00005.jpg','00006.jpg',
      '00007.jpg','00008.jpg','00009.jpg','00010.jpg',
      '00011.jpg','00012.jpg','00013.jpg','00014.jpg',
      '00015.jpg','00016.jpg','00017.jpg','00018.jpg',
      '00019.jpg','00020.jpg','00021.jpg','00022.jpg',
      '00023.jpg','00024.jpg'
    ];
    const imageGrid = document.getElementById('imageGrid');
    partFiles.forEach(filename => {
      const img = document.createElement('img');
      img.src = filename;
      img.alt = filename;
      img.draggable = true;
      img.addEventListener('dragstart', dragStart);
      imageGrid.appendChild(img);
    });
  });

  // Position map for layering (adjust coords)
  const partPositions = {
    '0000D_.jpg': { top:230, left:50 },
    '0000B.jpg': { top:170, left:130 },
    '0000C.jpg': { top:140, left:210 },
    '0000A_.jpg': { top:90, left:290 },
    // add others...
    '00024.jpg': { top:50, left:200 }
  };

  const buildArea = document.getElementById('buildArea');
  const imageGrid = document.getElementById('imageGrid');

  function allowDrop(ev) { ev.preventDefault(); }

  function dragStart(ev) { ev.dataTransfer.setData("text/plain", ev.target.src); }

  function drop(ev) {
    ev.preventDefault();
    const src = ev.dataTransfer.getData("text/plain");
    const filename = src.split('/').pop();

    if (buildArea.querySelector(`img[src$="${filename}"]`)) return;

    const gridImg = Array.from(imageGrid.querySelectorAll('img'))
      .find(img => img.src.endsWith(filename));
    if (gridImg) gridImg.remove();

    const pos = partPositions[filename];
    if (!pos) { alert(`No position for ${filename}`); return; }

    const img = document.createElement('img');
    img.src = filename;
    img.alt = filename;
    img.style.top = pos.top + 'px';
    img.style.left = pos.left + 'px';
    img.addEventListener('click', () => {
      img.remove();
      const re = document.createElement('img');
      re.src = filename;
      re.alt = filename;
      re.draggable = true;
      re.addEventListener('dragstart', dragStart);
      imageGrid.appendChild(re);
    });
    buildArea.appendChild(img);
  }

  let mediaRecorder, audioChunks = [];

  async function startRecording() {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];
    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
    mediaRecorder.onstop = () => {
      const blob = new Blob(audioChunks, { type:'audio/webm' });
      document.getElementById('audioPlayback').src = URL.createObjectURL(blob);
    };
    mediaRecorder.start();
  }

  function stopRecording() {
    if (mediaRecorder && mediaRecorder.state !== "inactive") mediaRecorder.stop();
  }

  function playRecording() {
    document.getElementById('audioPlayback').play();
  }
  </script>
</body>
</html>


