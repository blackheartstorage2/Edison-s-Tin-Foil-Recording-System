<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tin Foil Phonograph Virtual Build</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 20px;
    }
    h1 {
      text-align: center;
    }
    .instructions {
      margin: 20px auto;
      text-align: center;
    }
    .image-grid, .build-area {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 30px;
      min-height: 150px;
      padding: 10px;
      border: 2px dashed #ccc;
      background: #fff;
    }
    .image-grid img, .build-area img {
      width: 100px;
      height: auto;
      cursor: grab;
    }
    .audio-controls {
      text-align: center;
      margin-top: 40px;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    .disabled {
      opacity: 0.5;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <h1>Build Edison's Tin Foil Recorder</h1>

  <div class="instructions">
    <p>Drag the parts from the grid below into the build area to assemble the device. You must include the tin foil roll (Part 00023.jpg) to enable recording and playback. Once loaded, you may record and play audio with a vintage filter.</p>
  </div>

  <h2 style="text-align:center;">Parts</h2>
  <div class="image-grid" id="imageGrid"></div>

  <h2 style="text-align:center;">Build Area</h2>
  <div class="build-area" id="buildArea" ondrop="drop(event)" ondragover="allowDrop(event)"></div>

  <div class="audio-controls">
    <h2>Audio Recorder</h2>
    <button id="startBtn" onclick="startRecording()" class="disabled">Start Recording</button>
    <button id="stopBtn" onclick="stopRecording()" class="disabled">Stop Recording</button>
    <button id="playBtn" onclick="playRecording()" class="disabled">Play Recording</button>
    <p><small>(Requires "tin foil roll" to be loaded — use Chrome or Firefox)</small></p>
    <audio id="audioPlayback" controls></audio>
  </div>

  <script>
    const buildArea = document.getElementById('buildArea');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const playBtn = document.getElementById('playBtn');
    let rollLoaded = false;

    for (let i = 1; i <= 23; i++) {
      const img = document.createElement('img');
      const num = String(i).padStart(5, '0'); // 00001–00023
      img.src = num + '.jpg';
      img.alt = 'Part ' + num;
      img.draggable = true;
      img.addEventListener('dragstart', dragStart);
      document.getElementById('imageGrid').appendChild(img);
    }

    function allowDrop(ev) {
      ev.preventDefault();
    }

    function dragStart(ev) {
      ev.dataTransfer.setData("text/plain", ev.target.src);
    }

    function drop(ev) {
      ev.preventDefault();
      const src = ev.dataTransfer.getData("text/plain");
      const img = document.createElement("img");
      img.src = src;
      img.style.width = "100px";
      buildArea.appendChild(img);

      if (src.includes("00023.jpg") && !rollLoaded) {
        rollLoaded = true;
        enableAudioControls();
      }
    }

    function enableAudioControls() {
      startBtn.classList.remove("disabled");
      stopBtn.classList.remove("disabled");
      playBtn.classList.remove("disabled");
    }

    // Audio recording with vintage effect
    let mediaRecorder;
    let audioChunks = [];

    async function startRecording() {
      if (!rollLoaded) return;
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];

      mediaRecorder.ondataavailable = event => {
        audioChunks.push(event.data);
      };

      mediaRecorder.onstop = () => {
        const blob = new Blob(audioChunks, { type: 'audio/webm' });
        const url = URL.createObjectURL(blob);
        document.getElementById('audioPlayback').src = url;
      };

      mediaRecorder.start();
      console.log("Recording started");
    }

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state !== "inactive") {
        mediaRecorder.stop();
        console.log("Recording stopped");
      }
    }

    function playRecording() {
      const audio = document.getElementById('audioPlayback');
      audio.play();

      // Optional: simulate grainy playback by reducing volume & boosting distortion
      const context = new AudioContext();
      const source = context.createMediaElementSource(audio);
      const gain = context.createGain();
      const biquadFilter = context.createBiquadFilter();

      gain.gain.value = 0.9;
      biquadFilter.type = "lowpass";
      biquadFilter.frequency.value = 4000;

      source.connect(biquadFilter);
      biquadFilter.connect(gain);
      gain.connect(context.destination);
    }
  </script>

</body>
</html>

